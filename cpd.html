<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.6 at 2017-02-06 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>backside-servlet-ks &#x2013; CPD Results</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20170206" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                    <div id="bannerLeft">
                backside-servlet-ks
                </div>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                    
                <div class="xleft">
        <span id="publishDate">Last Published: 2017-02-06</span>
                  &nbsp;| <span id="projectVersion">Version: 0.10.0-SNAPSHOT</span>
                      </div>
            <div class="xright">                    <a href="./" title="backside-servlet-ks">backside-servlet-ks</a>
              
                    
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                    
                                          <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                                                                                                                            <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                                                                                                                                                                                <li class="expanded">
                          <a href="project-reports.html" title="Project Reports">Project Reports</a>
                    <ul>
                      <li class="none">
                          <a href="surefire-report.html" title="Surefire Report">Surefire Report</a>
            </li>
                      <li class="none">
                          <a href="property-updates-report.html" title="Property Updates Report">Property Updates Report</a>
            </li>
                      <li class="none">
                          <a href="plugin-updates-report.html" title="Plugin Updates Report">Plugin Updates Report</a>
            </li>
                      <li class="none">
                          <a href="dependency-updates-report.html" title="Dependency Updates Report">Dependency Updates Report</a>
            </li>
                      <li class="none">
                          <a href="xref/index.html" title="Source Xref">Source Xref</a>
            </li>
                      <li class="none">
                          <a href="xref-test/index.html" title="Test Source Xref">Test Source Xref</a>
            </li>
                      <li class="none">
                          <a href="dependency-check-report.html" title="Dependency Check">Dependency Check</a>
            </li>
                      <li class="none">
            <strong>CPD</strong>
          </li>
                      <li class="none">
                          <a href="pmd.html" title="PMD">PMD</a>
            </li>
                      <li class="none">
                          <a href="taglist.html" title="Tag List">Tag List</a>
            </li>
              </ul>
        </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                   
                    
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <div class="section">
<h2><a name="CPD_Results"></a>CPD Results</h2>
<p>The following document contains the results of PMD's  <a class="externalLink" href="http://pmd.sourceforge.net/cpd.html">CPD</a> 5.5.1.</p></div>
<div class="section">
<h2><a name="Duplications"></a>Duplications</h2>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>org/topicquests/backside/servlet/apps/BaseHandler.java</td>
<td>213</td></tr>
<tr class="a">
<td>org/topicquests/backside/servlet/apps/gui/GUIHandler.java</td>
<td>168</td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>    public String getPath(HttpServletRequest request) throws ServletException {
    	String path = notNullString(request.getPathInfo()).trim();
//    	System.out.println(&quot;FOO &quot;+path);
//    	System.out.println(&quot;QUERY &quot;+this.getQueryString(request));
//    	System.out.println(&quot;DATA &quot;+request.getParameter(&quot;data&quot;));
//    	System.out.println(&quot;LENGTH &quot;+request.getContentLength());
    	//Enumeration&lt;String&gt; ex = request.getHeaderNames();
    	Enumeration&lt;String&gt; ex = request.getParameterNames();
    	if (ex != null) {
    		List&lt;String&gt;l = new ArrayList&lt;String&gt;();
    		while (ex.hasMoreElements())
    			l.add(ex.nextElement());
    		//System.out.println(&quot;HEADERNAMES &quot;+l);
    		//HEADERNAMES [Origin, Accept, Connection, User-Agent, Referer, Host, DNT, Accept-Encoding, Accept-Language, Content-Length, Content-Type]
    		//That was no help
 //   		System.out.println(&quot;PARAMNAMES &quot;+l);
    		//PARAMNAMES [{&quot;verb&quot;:&quot;Auth&quot;,&quot;uEmail&quot;:&quot;joe&quot;,&quot;uPwd&quot;:&quot;joe&quot;}]
    		// the first one is our data
    	}
    	
    	try {
    		InputStream ins = request.getInputStream();
    		if (ins != null) {
    			StringBuilder buf = new StringBuilder();
    			int c;
    			while ((c = ins.read()) &gt; -1)
    				buf.append((char)c);
        		System.out.println(buf.toString());
    			
    		}
    	} catch (Exception x) {
    		System.out.println(&quot;BaseHandler.getPath booboo &quot;+x.getMessage());
    	}
    	if (path.startsWith(&quot;/&quot;))
    		path = path.substring(1);
    	if (path.endsWith(&quot;/&quot;))
    		path = path.substring(0,path.length()-1);
    	try {
    		path = URLDecoder.decode(path, &quot;UTF8&quot;);
    	} catch (Exception e) {
    		throw new ServletException(e);
    	}
    	if (path != null &amp;&amp; path.startsWith(&quot;/&quot;))
    		path = path.substring(1);
    	System.out.println(path);
    	return path;
    }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>org/topicquests/backside/servlet/apps/administrator/AdministratorHandler.java</td>
<td>67</td></tr>
<tr class="a">
<td>org/topicquests/backside/servlet/apps/stat/FileHelper.java</td>
<td>101</td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>	  } else if (f.exists()) {
		  String mimeType = &quot;images/&quot;;
          
		  if (path.endsWith(&quot;gif&quot;) || path.endsWith(&quot;GIF&quot;))
			  mimeType +=&quot;gif&quot;;
		  else if (path.endsWith(&quot;x-png&quot;) || path.endsWith(&quot;png&quot;) || path.endsWith(&quot;PNG&quot;))
			  mimeType += &quot;png&quot;;
		  else if (path.endsWith(&quot;.jpg&quot;) || path.endsWith(&quot;.JPG&quot;))
			  mimeType += &quot;jpg&quot;;
		  else if (path.endsWith(&quot;tiff&quot;) || path.endsWith(&quot;tif&quot;))
			  mimeType += &quot;tif&quot;;
		  else if (path.endsWith(&quot;ico&quot;))
			  mimeType += &quot;ico&quot;;
           response.setContentType(mimeType);
	    int len = 0;
	    byte[] buf = new byte[4096];
	    InputStream input = null;
	    OutputStream output = null;
	    try {
		    input = new BufferedInputStream(new FileInputStream(f));
		    output = response.getOutputStream();
            while ((len = input.read(buf)) &gt; -1) {
                output.write(buf, 0, len);
            }
	    } catch (IOException e) {
	    	environment.logError(&quot;IssueQuestServer.sendImage error &quot;+e.getMessage(),e);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>org/topicquests/backside/servlet/apps/tm/TopicMapHandler.java</td>
<td>150</td></tr>
<tr class="a">
<td>org/topicquests/backside/servlet/apps/tm/TopicMapHandler.java</td>
<td>230</td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>			r = model.listInstanceTopics(typeLocator, start, count, credentials);
			if (r.hasError()) {
				code = BaseHandler.RESPONSE_INTERNAL_SERVER_ERROR;
				message = r.getErrorString();
			} else {
				//Time to take that list apart
				if (r.getResultObject() != null) {
					List&lt;ISubjectProxy&gt; usrs = (List&lt;ISubjectProxy&gt;)r.getResultObject();
					Iterator&lt;ISubjectProxy&gt;itr = usrs.iterator();
					List&lt;JSONObject&gt;jsonUsers = new ArrayList&lt;JSONObject&gt;();
					while (itr.hasNext()) {
						jsonUsers.add((JSONObject)itr.next().getData());
					}
					returnMessage.put(ICredentialsMicroformat.CARGO, jsonUsers);
					code = BaseHandler.RESPONSE_OK;
					message = &quot;ok&quot;;
				} else {
					message = &quot;Not found&quot;;
					code = BaseHandler.RESPONSE_OK;
				}

			}
/*		} else if (verb.equals(ITopicMapMicroformat.LIST_ALL_BLOG_POSTS)) { 
			String startS = notNullString((String)jsonObject.get(ICredentialsMicroformat.ITEM_FROM));
			String countS = notNullString((String)jsonObject.get(ICredentialsMicroformat.ITEM_COUNT));
			int start = 0, count = -1;
			if (!startS.equals(&quot;&quot;)) {
				try {
					start = Integer.valueOf(startS);
				} catch (Exception e1) {}
			}
			if (!countS.equals(&quot;&quot;)) {
				try {
					count = Integer.valueOf(countS);
				} catch (Exception e2) {}
			}
			//TODO: note: we are ignoring any SORT modifiers
			//This really returns some live cargo in the form of a list of user objects in JSON format
			// We are restricting this to: name, email, avatar, homepage, geolocation, role
			r = model.listAllBlogPosts(start, count, credentials);
			if (r.hasError()) {
				code = BaseHandler.RESPONSE_INTERNAL_SERVER_ERROR;
				message = r.getErrorString();
			} else {
				//Time to take that list apart
				if (r.getResultObject() != null) {
					List&lt;ISubjectProxy&gt; usrs = (List&lt;ISubjectProxy&gt;)r.getResultObject();
					Iterator&lt;ISubjectProxy&gt;itr = usrs.iterator();
					List&lt;JSONObject&gt;jsonUsers = new ArrayList&lt;JSONObject&gt;();
					while (itr.hasNext()) {
						jsonUsers.add((JSONObject)itr.next().getData());
					}
					returnMessage.put(ICredentialsMicroformat.CARGO, jsonUsers);
					code = BaseHandler.RESPONSE_OK;
					message = &quot;ok&quot;;
				} else {
					message = &quot;Not found&quot;;
					code = BaseHandler.RESPONSE_OK;
				}

			} */
		} else if (verb.equals(ITopicMapMicroformat.LIST_SUBCLASS_TOPICS)) { </pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>org/topicquests/backside/servlet/apps/tm/TopicMapHandler.java</td>
<td>95</td></tr>
<tr class="a">
<td>org/topicquests/backside/servlet/apps/tm/TopicMapHandler.java</td>
<td>150</td></tr>
<tr class="b">
<td>org/topicquests/backside/servlet/apps/tm/TopicMapHandler.java</td>
<td>230</td></tr>
<tr class="a"><td colspan='2'>
<div>
<pre>			r = model.listUserTopics(start, count, credentials);
			if (r.hasError()) {
				code = BaseHandler.RESPONSE_INTERNAL_SERVER_ERROR;
				message = r.getErrorString();
			} else {
				//Time to take that list apart
				if (r.getResultObject() != null) {
					List&lt;ISubjectProxy&gt; usrs = (List&lt;ISubjectProxy&gt;)r.getResultObject();
					Iterator&lt;ISubjectProxy&gt;itr = usrs.iterator();
					List&lt;JSONObject&gt;jsonUsers = new ArrayList&lt;JSONObject&gt;();
					while (itr.hasNext()) {
						jsonUsers.add((JSONObject)itr.next().getData());
					}
					returnMessage.put(ICredentialsMicroformat.CARGO, jsonUsers);
					code = BaseHandler.RESPONSE_OK;
					message = &quot;ok&quot;;
				} else {
					message = &quot;Not found&quot;;
					code = BaseHandler.RESPONSE_OK;
				}

			}
		} else if (verb.equals(ITopicMapMicroformat.GET_TOPIC)) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Line</th></tr>
<tr class="a">
<td>org/topicquests/backside/servlet/apps/stat/FileHelper.java</td>
<td>132</td></tr>
<tr class="b">
<td>org/topicquests/backside/servlet/apps/upload/UploadHelper.java</td>
<td>128</td></tr>
<tr class="a"><td colspan='2'>
<div>
<pre>	  }
	} 
    /**
     * &lt;p&gt;Paths that come in without a trailing '/' can be null&lt;/p&gt;
     * @param request
     * @return
     * @throws ServletException
     */
    protected String getPath(HttpServletRequest request) throws ServletException {
    	String path = notNullString(request.getPathInfo()).trim();

    	if (path.startsWith(&quot;/&quot;))
    		path = path.substring(1);
    	if (path.endsWith(&quot;/&quot;))
    		path = path.substring(0,path.length()-1);
    	try {
    		path = URLDecoder.decode(path, &quot;UTF8&quot;);
    	} catch (Exception e) {
    		throw new ServletException(e);
    	}
    	if (path != null &amp;&amp; path.startsWith(&quot;/&quot;))
    		path = path.substring(1);
    	System.out.println(path);
    	return path;
    }
    
    protected String notNullString(String val) {
    	if (val != null) return val;
    	return &quot;&quot;;
    }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Line</th></tr>
<tr class="a">
<td>org/topicquests/backside/servlet/apps/admin/AdminModel.java</td>
<td>160</td></tr>
<tr class="b">
<td>org/topicquests/backside/servlet/apps/usr/UserModel.java</td>
<td>317</td></tr>
<tr class="a"><td colspan='2'>
<div>
<pre>					System.out.println(&quot;GETMAPCONNECTIOn &quot; + con);
				}
				result.setResultObject(con);
			} catch (Exception e) {
				result.addErrorString(e.getMessage());
				environment.logError(e.getMessage(), e);
			}
			return result;
		}
	}

	public IResult closeLocalConnection() {
		IResult result = new ResultPojo();
		boolean isError = false;
		try {
			synchronized (localMapConnection) {
				Connection con = this.localMapConnection.get();
				if (con != null)
					con.close();
				localMapConnection.remove();
				//  localMapConnection.set(null);
			}
		} catch (SQLException e) {
			isError = true;
			result.addErrorString(e.getMessage());
		}
		if (!isError)
			result.setResultObject(&quot;OK&quot;);
		return result;
	}

	@Override
	public void shutDown() {
		closeLocalConnection();
	}


}</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Line</th></tr>
<tr class="a">
<td>org/topicquests/backside/servlet/apps/condo/CondoHandler.java</td>
<td>78</td></tr>
<tr class="b">
<td>org/topicquests/backside/servlet/apps/tm/TopicMapHandler.java</td>
<td>330</td></tr>
<tr class="a"><td colspan='2'>
<div>
<pre>		}  else {
			String x = IErrorMessages.BAD_VERB+&quot;-UserServletGet-&quot;+verb;
			environment.logError(x, null);
			throw new ServletException(x);
		}
		returnMessage.put(ICredentialsMicroformat.RESP_TOKEN, rtoken);
		returnMessage.put(ICredentialsMicroformat.RESP_MESSAGE, message);
		super.sendJSON(returnMessage.toJSONString(), code, response);
		returnMessage = null;
	}
	
	
	public void handlePost(HttpServletRequest request, HttpServletResponse response, ITicket credentials, JSONObject jsonObject) throws ServletException, IOException {
		JSONObject returnMessage = newJSONObject();
		JSONObject cargo = (JSONObject)jsonObject.get(ICredentialsMicroformat.CARGO);
		String message = &quot;&quot;, rtoken=&quot;&quot;;
		String verb = getVerb(jsonObject);
		int code = 0;
		IResult r;
		System.out.println(&quot;CondoHandler.handlePost &quot;+verb);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Line</th></tr>
<tr class="a">
<td>org/topicquests/backside/servlet/apps/tm/TopicMapModel.java</td>
<td>492</td></tr>
<tr class="b">
<td>org/topicquests/backside/servlet/apps/tm/TopicMapModel.java</td>
<td>520</td></tr>
<tr class="a"><td colspan='2'>
<div>
<pre>		environment.logDebug(&quot;TopicMapModel.listTopicsByURL+ &quot;+result.getErrorString()+&quot; | &quot;+result.getResultObject());
		//TopicMapModel.getTopicByURL+  | [org.topicquests.ks.tm.SubjectProxy@6aab361d, org.topicquests.ks.tm.SubjectProxy@1098da46]
		List&lt;Object&gt; lx = (List&lt;Object&gt;)result.getResultObject();
		if (lx != null) {
			if (lx.size() &gt; 0) {
				try {
					ISubjectProxy n = (SubjectProxy)(lx.get(0));
					result.setResultObject(n);
				} catch (Exception ex) {
					environment.logError(ex.getMessage(), ex);
					result.addErrorString(ex.getMessage());
					result.setResultObject(null);
				}
			} else
				result.setResultObject(null);
		}
		System.out.println(&quot;LISTTOPICSBYURL+ &quot;+result.getErrorString()+&quot; | &quot;+result.getResultObject());</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Line</th></tr>
<tr class="a">
<td>org/topicquests/backside/servlet/apps/gui/GUIHandler.java</td>
<td>201</td></tr>
<tr class="b">
<td>org/topicquests/backside/servlet/apps/stat/FileHelper.java</td>
<td>143</td></tr>
<tr class="a"><td colspan='2'>
<div>
<pre>    	if (path.startsWith(&quot;/&quot;))
    		path = path.substring(1);
    	if (path.endsWith(&quot;/&quot;))
    		path = path.substring(0,path.length()-1);
    	try {
    		path = URLDecoder.decode(path, &quot;UTF8&quot;);
    	} catch (Exception e) {
    		throw new ServletException(e);
    	}
    	if (path != null &amp;&amp; path.startsWith(&quot;/&quot;))
    		path = path.substring(1);
    	System.out.println(path);
    	return path;
    }
    
    protected String notNullString(String val) {
    	if (val != null) return val;
    	return &quot;&quot;;
    }

}</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Line</th></tr>
<tr class="a">
<td>org/topicquests/backside/servlet/apps/gui/GUIHandler.java</td>
<td>201</td></tr>
<tr class="b">
<td>org/topicquests/backside/servlet/apps/upload/UploadHelper.java</td>
<td>133</td></tr>
<tr class="a"><td colspan='2'>
<div>
<pre>    	if (path.startsWith(&quot;/&quot;))
    		path = path.substring(1);
    	if (path.endsWith(&quot;/&quot;))
    		path = path.substring(0,path.length()-1);
    	try {
    		path = URLDecoder.decode(path, &quot;UTF8&quot;);
    	} catch (Exception e) {
    		throw new ServletException(e);
    	}
    	if (path != null &amp;&amp; path.startsWith(&quot;/&quot;))
    		path = path.substring(1);
    	System.out.println(path);
    	return path;
    }
    
    protected String notNullString(String val) {
    	if (val != null) return val;
    	return &quot;&quot;;
    }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Line</th></tr>
<tr class="a">
<td>org/topicquests/backside/servlet/apps/gui/GUIHandler.java</td>
<td>125</td></tr>
<tr class="b">
<td>org/topicquests/backside/servlet/apps/upload/UploadHandler.java</td>
<td>125</td></tr>
<tr class="a"><td colspan='2'>
<div>
<pre>	}
	
	String getCoreQuery(String verb, String userId, String userIP, String sToken) throws ServletException {
		try {
			JSONObject json = new JSONObject();
			json.put(ICredentialsMicroformat.VERB, verb);
			json.put(ICredentialsMicroformat.USER_ID, userId);
			json.put(ICredentialsMicroformat.SESSION_TOKEN, sToken);
			json.put(ICredentialsMicroformat.USER_IP, userIP);
			String result = json.toJSONString();
			result = URLEncoder.encode(result, &quot;UTF-8&quot;);
			json = null;
			return result;
		} catch (Exception e) {
			environment.logError(e.getMessage(), e);
			throw new ServletException(e);
		}
	}</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Line</th></tr>
<tr class="a">
<td>org/topicquests/backside/servlet/apps/BaseHandler.java</td>
<td>246</td></tr>
<tr class="b">
<td>org/topicquests/backside/servlet/apps/stat/FileHelper.java</td>
<td>143</td></tr>
<tr class="a">
<td>org/topicquests/backside/servlet/apps/upload/UploadHelper.java</td>
<td>133</td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>    	if (path.startsWith(&quot;/&quot;))
    		path = path.substring(1);
    	if (path.endsWith(&quot;/&quot;))
    		path = path.substring(0,path.length()-1);
    	try {
    		path = URLDecoder.decode(path, &quot;UTF8&quot;);
    	} catch (Exception e) {
    		throw new ServletException(e);
    	}
    	if (path != null &amp;&amp; path.startsWith(&quot;/&quot;))
    		path = path.substring(1);
    	System.out.println(path);
    	return path;
    }</pre></div></td></tr></table></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                    2015&#x2013;2017
                        <a href="http://topicquests.org">TopicQuests Foundation</a>.
            All rights reserved.      
                    
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
